# 🔐 중복 지원 방지 시스템 설정 가이드

## 📋 시스템 구조

```
클라이언트 (asd.html)
    ↓ (localStorage 확인)
    ↓ (중복 없으면 서버로 전송)
    ↓
서버 (Google Apps Script)
    ↓ (이메일/휴대폰 중복 검사)
    ↓
결과:
  ✅ 정상 제출 → 지원서 시트에 저장
  ❌ 중복 감지 → 블랙리스트에 기록
```

## ⚙️ 설정 단계

### 1️⃣ Google Sheet 생성
1. Google Drive에서 새 스프레드시트 생성
2. 이름: "팀원모집_지원서"
3. 다음 시트 생성:
   - "지원서" (메인 데이터)
   - "블랙리스트" (중복 시도 기록)
   - "로그" (모든 시도 기록)

### 2️⃣ Google Apps Script 설정
1. 스프레드시트 열기
2. 확장 프로그램 → App Script 클릭
3. `duplicate_check.gs` 코드 복사 붙여기
4. 코드에서 `YOUR_SPREADSHEET_ID` 부분을 자신의 스프레드시트 ID로 변경
   ```javascript
   const SPREADSHEET_ID = "1a2b3c4d5e6f7g8h9i"; // 예: URL에서 추출
   ```
5. 배포 → 새 배포
   - 유형: 웹 앱
   - 실행 대상: 본인
   - 액세스: 누구나
6. 배포 URL 복사

### 3️⃣ asd.html 수정
`asd.html`에서:
```javascript
const SCRIPT_URL = "YOUR_DEPLOYED_SCRIPT_URL";
// 예: "https://script.google.com/macros/s/AKfycbw...../exec"
```

### 4️⃣ 테스트
1. asd.html 열기
2. 폼 작성 후 제출
3. Google Sheet에서 데이터 확인
4. 같은 이메일로 다시 시도 → "중복" 메시지 나와야 함

---

## 🎯 보안 기능

### ✅ 클라이언트 측
- localStorage에 제출 기록 저장
- IndexedDB에 백업
- sessionStorage에 임시 저장
- 고유 Device ID 생성

### ✅ 서버 측 (Google Apps Script)
- **이메일 중복 검사**: 이미 제출한 이메일 거절
- **휴대폰 중복 검사**: 이미 제출한 휴대폰 거절
- **블랙리스트**: 중복 시도한 사람 기록
- **로그**: 모든 시도 기록 (정상/중복)

### ✅ 우회 방지
- 캐시 삭제해도 서버에서 감지
- 다른 브라우저/시크릿 모드도 감지
- 휴대폰 번호로도 중복 감지
- 여러 번 시도하면 블랙리스트에 추가

---

## 📊 Google Sheet 구조

### "지원서" 시트
| 제출 시간 | 이름 | 팀명 | 이메일 | 휴대폰 | 지원 분야 | 지원 동기 | User Agent | Device ID |
|---|---|---|---|---|---|---|---|---|

### "블랙리스트" 시트
| 기록 시간 | 이메일 | 휴대폰 | 사유 | 상태 |
|---|---|---|---|---|
| 2025-10-16 | test@example.com | 010-1234-5678 | 중복 지원 시도 | 차단됨 |

### "로그" 시트
| 시간 | 이메일 | 휴대폰 | 이름 | 팀명 | 결과 | 상세 데이터 |
|---|---|---|---|---|---|---|

---

## 🔍 중복 감지 방식

### 우선순위
1. **이메일** (가장 신뢰도 높음)
   - 한 사람 = 한 이메일
   - 우회 어려움

2. **휴대폰 번호** (신뢰도 높음)
   - 한 사람 = 한 휴대폰
   - 이메일 변경해도 감지

3. **Device ID + User Agent** (보조)
   - 같은 컴퓨터에서 여러 번 시도 감지
   - 캐시 삭제 우회 불가능

---

## ⚡ 개선 사항 (향후 추가 가능)

1. **Google 로그인 필수**
   - 한 구글 계정 = 한 번만 지원

2. **문자 인증**
   - 휴대폰 번호로 OTP 전송
   - 실제 휴대폰 소유자만 지원 가능

3. **IP 차단**
   - 같은 IP에서 여러 번 시도 → 차단

4. **시간 제한**
   - 같은 이메일에서 24시간 내 재시도 차단

---

## 🚨 주의사항

- ⚠️ Google Apps Script는 무료이지만 할당량 제한 있음
- ⚠️ 스프레드시트 ID를 안전하게 보관하기
- ⚠️ 블랙리스트에 추가된 사람 복구는 직접 삭제해야 함

---

## 📞 문제 해결

### Q: "서버 오류" 메시지가 나옵니다
A: 
1. Google Apps Script 배포 URL 확인
2. SPREADSHEET_ID 올바른지 확인
3. 구글 시트 공유 설정 확인

### Q: 중복 감지가 안 됩니다
A:
1. 이메일과 휴대폰 번호가 정확히 같은지 확인
2. 대소문자/공백 확인 (시스템이 소문자로 통일)
3. Google Sheet에서 데이터 수동 확인

### Q: 차단된 사람이 다시 지원하고 싶어요
A:
1. "블랙리스트" 시트에서 해당 행 삭제
2. "지원서" 시트에서 해당 데이터도 삭제
3. 복구 완료 (재지원 가능)
